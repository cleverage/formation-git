<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Formation Git - Clever Institut</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Formation Git</h1>
        <h2>Base documentaire pour la formation Clever Institut sur l'utilisation de Git</h2>
        <a href="https://github.com/cleverage/formation-git" class="button"><small>View project on</small>GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h3>Installation de Gitosis</h3>
          <p>Gitosis est une collection de scripts qui aident à gérer le fichier <code>authorized_keys</code> ainsi qu'à implémenter des contrôles d'accès simples. La partie la plus intéressante de l'outil repose sur le fait que l'interface d'administration permettant d'ajouter des utilisateurs et de déterminer leurs droits n'est pas une interface web mais un dépôt Git. Pour paramétrer les informations relatives à un projet, il suffit de pousser vos modifications, et Gitosis reconfigure les serveurs en fonction des données.</p>

<p>L'installation de Gitosis n'est pas des plus aisées. Elle est plus simple sur un serveur Linux — les exemples qui suivent utilisent une distribution Ubuntu Server 8.10 de base.</p>

<p>Gitosis nécessite des outils Python. Il faut donc installer le paquet Python setuptools. Sous Ubuntu, il est fournit en tant que python-setuptools :
<code>$ apt-get install python-setuptools</code>
</p>

<p>Ensuite, il faut cloner et installer Gitosis à partir du site principal du projet :</p>
<code>$ git clone git://eagain.net/gitosis.git <br/>
$ cd gitosis <br/>
$ sudo python setup.py install</code>

          <p>Gitosis est une collection de scripts qui aident à gérer le fichier <code>authorized_keys</code> ainsi qu'à implémenter des contrôles d'accès simples. La partie la plus intéressante de l'outil repose sur le fait que l'interface d'administration permettant d'ajouter des utilisateurs et de déterminer leurs droits n'est pas une interface web mais un dépôt Git. Pour paramétrer les informations relatives à un projet, il suffit de pousser vos modifications, et Gitosis reconfigure les serveurs en fonction des données.</p>

<p>L'installation de Gitosis n'est pas des plus aisées. Elle est plus simple sur un serveur Linux — les exemples qui suivent utilisent une distribution Ubuntu Server 8.10 de base.</p>

<p>Gitosis nécessite des outils Python. Il faut donc installer le paquet Python setuptools. Sous Ubuntu, il est fournit en tant que python-setuptools :
</p>
<div><code>$ apt-get install python-setuptools</code></div>

<p>Ensuite, il faut cloner et installer Gitosis à partir du site principal du projet :</p>
<div><code>$ git clone git://eagain.net/gitosis.git <br />
$ cd gitosis <br />
$ sudo python setup.py install</code></div>

<p>La dernière commande installe deux exécutables que Gitosis utilisera. <br />
  Par défaut, Gitosis gère ses dépôts sous <code>/home/git</code>, ce qui est parfait, sauf si vous avez déjà installé vos dépôts autre part. Dans ce cas précis, il suffit de créer un lien symbolique.</p>

<div><code>$ ln -s /opt/git /home/git/repositories</code></div>

<p>Comme Gitosis s'occupe de gérer les clés SSH pour vous, plus besoin du fichier <code>authorized_keys</code>. Afin de ne pas le supprimer complètement pour le moment, déplacez le fichier <code>authorized_keys</code> ailleurs : </p>

<div><code>$ mv /home/git/.ssh/authorized_keys /home/git/.ssh/ak.bak</code></div>

<p>Avant de continuer, assurez-vous que :
<ul> 
  <li>Le shell de votre utilisateur est bien celui par défaut, et non pas <code>git-shell</code>. Si ce n'est pas le cas, modifiez le fichier <code>/etc/passwd</code> pour avoir :<code>git:x:1000:1000::/home/git:/bin/sh</code> à la place de <code>git:x:1000:1000::/home/git:/usr/bin/git-shell</code></li>
  <li>Votre clé publique est bien présente sur le serveur. L'utilisateur correspondant à la clé publique que l'on utilisera sera le seul à pouvoir paramétrer Gitosis.</li>
</ul></p>

<p>Vous pouvez maintenant initialiser Gitosis en lançant la commande <code>gitosis-init</code> avec votre clef publique.</p>

<div><code>$ sudo -H -u git gitosis-init < /tmp/id_dsa.pub</code></div>

<p>Ensuite, changez les droits du script <code>post-update</code> du dépôt de contrôle nouvellement créé :</p>

<div><code>$ sudo chmod 755 /opt/git/gitosis-admin.git/hooks/post-update</code></div>

<p>Si tout a fonctionné correctement, essayez de vous connecter par SSH au serveur en utilisant la commande <code>$ ssh git@gitserveur</code>, où git est l'utilisateur pour lequel vous avez configurer Gitosis, et gitserver l'url de votre serveur. <br />
Vous devriez voir quelque chose comme :</p>

<code>
PTY allocation request failed on channel 0 <br />
  fatal: unrecognized command 'gitosis-serve jfemia@clever-pc' <br />
Connection to gitserver closed.</code>

<p>Cela signifie que Gitosis vous a bien reconnu mais vous a rejeté car vous ne lancez pas de commandes Git. <br /> 
  Lançons donc une vraie commande Git en clonant le dépôt de contrôle Gitosis : </p>

<div><code>$ git clone git@gitserver:gitosis-admin.git</code></div>
<p>En regardant ce que l'on vient de cloner de plus près, on a donc :

<ul>
  <li>Un fichier <code>gitosis.conf, qui permet de spécifier les utilisateurs, les dépôts et les permissions</code></li>
  <li>un répertoire <code>keydir</code> qui contient les clés publiques de tous les utilisateurs qui peuvent avoir accès à vos dépôts</li>
</ul>
</p>
        </section>

        <aside id="sidebar">
          <div class="center">
        <a href="http://www.clever-age.com" target="_blank" class="clever-button">
          <img src="http://cleverage.github.com/formation-git/images/clever-age-logo.png" width="70%" />
        </a>
        <p>Paris, Lyon, Bordeaux, Nantes, Genève</p>
        <a href="http://www.clever-institut.com" target="_blank">
          <img src="http://cleverage.github.com/formation-git/images/clever-institut-logo.png"/>
        </a>
        </div>
          <!--<a href="https://github.com/cleverage/formation-git/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/cleverage/formation-git/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>-->
        </aside>
      </div>
    </div>

  
  </body>
</html>